### 1\. 【Step 1-2】パターンD（法人・フリート）の業務フロー仮説

「パターンA（個人）」と最も構造が異なるのが、法人による社用車の一括導入（フリート）ケースです。
上司の懸念点である「商流の違い」と「意思決定と現場の分離」を仮説として可視化しました。

**▼ パターンDの仮説フロー（B2Bモデル）**

```mermaid
sequenceDiagram
    autonumber
    actor Driver as 現場担当者<br>(支店/ドライバー)
    actor HQ as 法人本社<br>(総務/管財)
    participant CorpSales as メーカー/販社<br>(法人営業部)
    participant Admin as 販社/メーカー<br>(経理・業務)
    participant CMC as 施工管理会社
    participant Installer as 施工会社

    Note over HQ, CorpSales: 【フェーズ1：包括契約・案件発生】
    HQ->>CorpSales: 1. 車両導入計画提示（〇〇台）
    CorpSales->>HQ: 2. 包括契約・単価合意
    Note right of CorpSales: ※都度の見積ではなく<br>単価契約の可能性が高い

    Note over Driver, CMC: 【フェーズ2：拠点ごとの現調】
    HQ->>CorpSales: 3. 設置拠点リスト送付
    CorpSales->>CMC: 4. 全拠点の現調依頼一括送付
    
    loop 拠点数分繰り返し
        CMC->>Installer: 5. 各拠点へ現調手配
        Installer->>Driver: 6. 現場日程調整
        Installer-->>Driver: 7. 現地調査実施
        Installer->>CMC: 8. 報告・個別見積作成
    end

    CMC->>CorpSales: 9. 全拠点分の見積/工事可否回答

    Note over HQ, CorpSales: 【フェーズ3：一括発注・承認】
    CorpSales->>HQ: 10. 工事リスト・総額提示
    HQ->>CorpSales: 11. 発注書発行（一括）
    
    Note over Driver, Installer: 【フェーズ4：施工・納品】
    CorpSales->>CMC: 12. 工事Goサイン
    CMC->>Installer: 13. 工事指示
    Installer->>Driver: 14. 工事日程調整（現場担当と）
    Installer->>Driver: 15. 施工・完了サイン受領
    Installer->>CMC: 16. 完了報告

    Note over HQ, Admin: 【フェーズ5：月締め請求】
    CMC->>CorpSales: 17. 完了案件の月次報告
    CorpSales->>Admin: 18. 売上確定
    Admin->>HQ: 19. 請求書発行（月締め一括）
    HQ->>Admin: 20. 支払い（翌月末払い等）
```

**【パターンAとの決定的な違い（ヒアリングでの確認ポイント）】**

1.  **契約形態**: 都度の注文書ではなく「基本契約＋発注リスト」ではないか？
2.  **窓口**: 店舗（ディーラー）ではなく「法人営業部」等の別組織が担当していないか？
3.  **日程調整**: 契約は本社だが、日程調整は現場（支店）と直接行う必要がある（連絡ルートの複線化）。

-----

### 2\. 【Step 2】差分と例外の構造化リスト（パターンAからの分岐）

パターンAの各プロセス（No.1〜30）に対し、「どこで」「どのような条件で」フローが変化するかを定義します。図を増やさず、このリストを元に要件定義の「条件分岐」を詰めます。

#### ① プロセス分岐（パターンB・Cへの派生）

| 分岐ID | 分岐条件（トリガー） | 発生タイミング | 追加・変更されるプロセス（サブルーチン） | 影響度 |
| :--- | :--- | :--- | :--- | :--- |
| **Branch-1** | **管理組合・オーナーの承諾必須**<br>（集合住宅・賃貸） | No.1 商談時<br>No.7 現調報告時 | **【承諾取得ループ】**<br>1. 施工店が図面・仕様書を作成<br>2. 施主が管理組合へ提出<br>3. 理事会承認待ち（数週間）<br>4. 承諾書受領 → フロー復帰 | **大**<br>リードタイムが数ヶ月単位で伸びる。<br>システム上で「保留（塩漬け）」ステータスの管理が必要。 |
| **Branch-2** | **電力申請が必要**<br>（アンペア変更・幹線張替え） | No.7 現調報告時 | **【東電申請ループ】**<br>1. 施工店が電力会社へ申請図面作成<br>2. 東京電力へ申請<br>3. 竣工検査・受電<br>※工事日が「申請許可」に依存するため確定できない。 | **中**<br>工事日程が「仮予約」運用になる。<br>電力会社側の都合で工期が遅れるリスク。 |
| **Branch-3** | **標準外工事（高額見積）**<br>（隠蔽配線不可、土木工事等） | No.9 見積回答時 | **【再商談ループ】**<br>1. 高額見積を提示し、顧客と折衝<br>2. 仕様変更（スペックダウン）またはキャンセル<br>3. 再見積作成 → No.10へ戻る | **中**<br>営業担当の手間が増大。<br>見積バージョンの管理が必要。 |

#### ② 例外処理（Exception）とシステム要件

「パターンA」の直線的なルートから外れるエラー系処理です。これらがシステム化の「漏れ」になりやすいため、重点的に定義します。

| 例外ID | 事象（インシデント） | 発生タイミング | 業務上の処置（システム要件） |
| :--- | :--- | :--- | :--- |
| **Ex-1** | **現調後キャンセル**<br>（見積高すぎ、工事不可） | No.10 見積提示後 | **【精算処理】**<br>・現地調査費（数千円〜）を誰が負担するか？<br>・顧客請求する場合の請求フロー起動。<br>・販社負担する場合の赤字処理。 |
| **Ex-2** | **工事当日キャンセル**<br>（不在、車両干渉、部材欠品） | No.22 工事当日 | **【再調整＆ペナルティ】**<br>・キャンセル料の請求可否判断。<br>・再工事日程の調整（No.16へ戻る）。<br>・部材の持ち帰り・在庫管理。 |
| **Ex-3** | **追加費用の発生**<br>（当日発覚した地中埋設物等） | No.22 工事当日 | **【事後請求処理】**<br>・当初契約（No.11）と金額がズレる。<br>・追加分の見積・請求書を「工事後」に発行する例外フロー。<br>・顧客の支払い手段（現金不可時の対応）。 |
| **Ex-4** | **施工不備・クレーム**<br>（充電できない、壁の傷） | No.24 完了後 | **【トラブルチケット起票】**<br>・責任分界（機器vs施工）の切り分け。<br>・補修工事の手配（無償/有償）。<br>・完了報告の取り消し・差し戻し。 |

-----